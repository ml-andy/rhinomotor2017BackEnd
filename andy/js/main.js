function getUrlVars(){for(var a,n=[],e=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),t=0;t<e.length;t++)a=e[t].split("="),n.push(a[0]),n[a[0]]=a[1];return n}$(document).ready(function(){function a(a,e){I.nowData=a,C.motifyPapering=!1,$(".menua.on").replaceWith('<li><span>最新消息</span><div class="box"></div></li>'),$(".menu ul li .box").html("");for(i in a)$(".menu ul li .box").append('<a class="menuain" href="javascript:;" data-brands="'+i+'">'+a[i].brands+"</a>");I.menulispan=$(".wrapper .menu li").find("span"),I.menulispan.click(function(){y($(this))}),I.menulispan.parent().hasClass("on")||I.menulispan.trigger("click"),I.menulia=$(".wrapper .menu li").find("a"),I.menulia.click(function(){n($(this).attr("data-brands"))}),n(e)}function n(a){var n=I.nowData;I.nowDataBrands=a,$(".title").html(n[a].brands),I.cot=$(".content .list ul"),I.cot.html("");for(k in n[I.nowDataBrands].press){I.cot.append('<li><div class="mainData"><div class="slbox">'+k+'</div><div class="column date">'+n[I.nowDataBrands].press[k].date+'</div><div class="column mainTitle">'+n[I.nowDataBrands].press[k].title+'</div><div class="column mainContent">'+n[I.nowDataBrands].press[k].content+'</div><div class="function"><a class="motify" href="javascript:;"></a><a class="delete" href="javascript:;"></a></div></div><div class="secData"></div></li>');var e="否";n[I.nowDataBrands].press[k].recommend&&(e="是"),I.cot.find("li:last .secData").append('<div class="recommend" data-recd="'+n[I.nowDataBrands].press[k].recommend+'"><div class="st">推薦</div><span>'+e+'</span><div class="btn change">更改</div></div>'),I.cot.find("li:last .secData").append('<div class="pressImg"><div class="st">圖片</div><div class="addImgBox"><input type="file" name="file" class="pressImgInput" accept="image/*" capture="camera"><div class="submit">確定新增</div></div><div class="photoDataBox"></div></div>');for(x in n[I.nowDataBrands].press[k].photo)I.cot.find("li:last .secData .pressImg .photoDataBox").append('<div class="photoData"><div class="photo"><img src="'+n[I.nowDataBrands].press[k].photo[x]+'"></div><div class="btn"><a href="javascript:;" class="delet"></a></div></div>')}$(".function .motify").click(function(){$(this).hasClass("on")?($(this).removeClass("on"),l($(this).parent().parent().find(".slbox").text())):($(this).addClass("on"),s(!0,$(this).parent().parent().find(".slbox").text()))}),$(".function .delete").click(function(){$(this).parent().find(".motify").hasClass("on")?($(this).parent().find(".motify").removeClass("on"),s(!1,$(this).parent().parent().find(".slbox").text())):window.confirm("確定刪除嗎?")&&d($(this).parent().parent().find(".slbox").text())}),$(".recommend .change").click(function(){j(!0),w($(this).parent().parent().parent().find(".slbox").text())}),$(".pressImgInput").change(function(){f(this)}),$(".addImgBox .submit").click(function(){return""==I.UploadImg?void alert("請先選擇檔案"):(j(!0),I.nowUploadImgNum=$(this).parent().parent().parent().parent().find(".slbox").text(),void m(I.UploadImg,u))}),$(".photoDataBox .delet").click(function(){window.confirm("確定刪除?")&&(j(!0),g($(this).parent().parent().index(),$(this).parent().parent().parent().parent().parent().parent().find(".slbox").text()))}),$(".menu ul li .box a").removeClass("on").eq(I.nowDataBrands).addClass("on"),j(!1)}function e(a,n){I.nowData=a,C.motifyPapering=!1,$(".menua.on").replaceWith('<li><span>產品介紹</span><div class="box"></div></li>'),$(".menu ul li .box").html("");for(i in a)$(".menu ul li .box").append('<a class="menuain" href="javascript:;" data-brands="'+i+'">'+a[i].brands+"</a>");I.menulispan=$(".wrapper .menu li").find("span"),I.menulispan.click(function(){y($(this))}),I.menulispan.parent().hasClass("on")||I.menulispan.trigger("click"),I.menulia=$(".wrapper .menu li").find("a"),I.menulia.click(function(){t($(this).attr("data-brands"))}),t(n)}function t(a){var n=I.nowData;I.nowDataBrands=a,$(".title").html(n[a].brands),I.cot=$(".content .list ul"),I.cot.html("");for(k in n[I.nowDataBrands].cars){I.cot.append('<li><div class="mainData"><div class="slbox">'+k+'</div><div class="column name">'+n[I.nowDataBrands].cars[k].name+'</div><div class="column price">'+n[I.nowDataBrands].cars[k].price+'</div><div class="column date">'+n[I.nowDataBrands].cars[k].date+'</div><div class="column info">'+n[I.nowDataBrands].cars[k].info+'</div><div class="column infoAll">'+n[I.nowDataBrands].cars[k].infoAll+'</div><div class="column des">'+n[I.nowDataBrands].cars[k].des+'</div><div class="function"><a class="motify" href="javascript:;"></a><a class="delete" href="javascript:;"></a></div></div><div class="secData"></div></li>'),I.cot.find("li:last .secData").append('<div class="eqi"><div class="st">配備</div><div class="addEqiBox"><input type="text" class="addEqi" placeholder="新增配備"><div class="submit">確定新增</div></div><div class="eqDataBox"></div></div>');for(x in n[I.nowDataBrands].cars[k].equipped)I.cot.find("li:last .secData .eqi .eqDataBox").append('<div class="equData"><span>'+n[I.nowDataBrands].cars[k].equipped[x]+'</span><div class="btn"><a href="javascript:;" class="delet">刪除</a></div></div>');var e="否";n[I.nowDataBrands].cars[k].recommend&&(e="是"),I.cot.find("li:last .secData").append('<div class="recommend" data-recd="'+n[I.nowDataBrands].cars[k].recommend+'"><div class="st">推薦</div><span>'+e+'</span><div class="btn change">更改</div></div>'),I.cot.find("li:last .secData").append('<div class="carsImg"><div class="st">圖片</div><div class="addImgBox"><input type="file" name="file" class="carsImgInput" accept="image/*" capture="camera"><div class="submit">確定新增</div></div><div class="photoDataBox"></div></div>');for(x in n[I.nowDataBrands].cars[k].carsImg)I.cot.find("li:last .secData .carsImg .photoDataBox").append('<div class="photoData"><div class="photo"><img src="'+n[I.nowDataBrands].cars[k].carsImg[x]+'"></div><div class="btn"><a href="javascript:;" class="delet"></a></div></div>')}$(".function .motify").click(function(){$(this).hasClass("on")?($(this).removeClass("on"),l($(this).parent().parent().find(".slbox").text())):($(this).addClass("on"),s(!0,$(this).parent().parent().find(".slbox").text()))}),$(".function .delete").click(function(){$(this).parent().find(".motify").hasClass("on")?($(this).parent().find(".motify").removeClass("on"),s(!1,$(this).parent().parent().find(".slbox").text())):window.confirm("確定刪除嗎?")&&d($(this).parent().parent().find(".slbox").text())}),$(".addEqiBox .submit").click(function(){var a=$(this).parent().find(".addEqi").val();""!=a&&void 0!=a?(j(!0),h($(this).parent().parent().parent().parent().find(".slbox").text(),a)):alert(C.motifyerrortxt)}),$(".eqDataBox .delet").click(function(){window.confirm("確定刪除?")&&(j(!0),v($(this).parent().parent().index(),$(this).parent().parent().parent().parent().parent().parent().find(".slbox").text()))}),$(".recommend .change").click(function(){j(!0),w($(this).parent().parent().parent().find(".slbox").text())}),$(".carsImgInput").change(function(){f(this)}),$(".addImgBox .submit").click(function(){return""==I.UploadImg?void alert("請先選擇檔案"):(j(!0),I.nowUploadImgNum=$(this).parent().parent().parent().parent().find(".slbox").text(),void m(I.UploadImg,u))}),$(".photoDataBox .delet").click(function(){window.confirm("確定刪除?")&&(j(!0),g($(this).parent().parent().index(),$(this).parent().parent().parent().parent().parent().parent().find(".slbox").text()))}),$(".menu ul li .box a").removeClass("on").eq(I.nowDataBrands).addClass("on"),j(!1)}function o(a,n){var e={brands:n,cars:[]};$.ajax({url:"https://api.mlab.com/api/1/databases/rhinomotor2017/collections/"+a+"?apiKey="+C.mlabApikey,type:"POST",contentType:"application/json",data:JSON.stringify(e),success:function(a){alert("新增成功"),window.location.reload()},error:function(a,n,e){_o.removeClass("on"),showloading(!1),console.log("error:",a,n,e)}})}function r(a,n){j(!0),$.ajax({url:"https://api.mlab.com/api/1/databases/rhinomotor2017/collections/"+a+"/"+I.nowData[n]._id.$oid+"?apiKey="+C.mlabApikey,type:"DELETE",async:!0,timeout:3e5,contentType:"application/json",success:function(a){location.reload()},error:function(a,n,e){console.log("error:",a,n,e)}})}function s(a,n,e){var t=$(".list").find("li").eq(n);if(a){if(C.motifyPapering)return alert(C.motifyerrortxt),void t.find(".motify").removeClass("on");C.motifyPapering=!0}else C.motifyPapering=!1;if(C.wrp.hasClass("cars")){var t=$(".list").find("li").eq(n);a?(t.find(".name").html("<textarea>"+t.find(".name").html().replace(/<br>/g,"\n")+"</textarea>"),t.find(".price").html("<textarea>"+t.find(".price").html().replace(/<br>/g,"\n")+"</textarea>"),t.find(".date").html("<textarea>"+t.find(".date").html().replace(/<br>/g,"\n")+"</textarea>"),t.find(".info").html("<textarea>"+t.find(".info").html().replace(/<br>/g,"\n")+"</textarea>"),t.find(".infoAll").html("<textarea>"+t.find(".infoAll").html().replace(/<br>/g,"\n")+"</textarea>"),t.find(".des").html("<textarea>"+t.find(".des").html().replace(/<br>/g,"\n")+"</textarea>")):(t.find(".name").html(t.find(".name textarea").val().replace(/\n\r?/g,"<br>")),t.find(".price").html(t.find(".price textarea").val().replace(/\n\r?/g,"<br>")),t.find(".date").html(t.find(".date textarea").val().replace(/\n\r?/g,"<br>")),t.find(".info").html(t.find(".info textarea").val().replace(/\n\r?/g,"<br>")),t.find(".infoAll").html(t.find(".infoAll textarea").val().replace(/\n\r?/g,"<br>")),t.find(".des").html(t.find(".des textarea").val().replace(/\n\r?/g,"<br>")))}else if(C.wrp.hasClass("press")){var t=$(".list").find("li").eq(n);a?(t.find(".date").html("<textarea>"+t.find(".date").html().replace(/<br>/g,"\n")+"</textarea>"),t.find(".mainTitle").html("<textarea>"+t.find(".mainTitle").html().replace(/<br>/g,"\n")+"</textarea>"),t.find(".mainContent").html("<textarea>"+t.find(".mainContent").html().replace(/<br>/g,"\n")+"</textarea>")):(t.find(".date").html(t.find(".date textarea").val().replace(/\n\r?/g,"<br>")),t.find(".mainTitle").html(t.find(".mainTitle textarea").val().replace(/\n\r?/g,"<br>")),t.find(".mainContent").html(t.find(".mainContent textarea").val().replace(/\n\r?/g,"<br>")))}}function l(n){j(!0);var t=$(".list").find("li").eq(n),i=I.nowData[I.nowDataBrands];C.wrp.hasClass("cars")?(i.cars[n].name=t.find(".name").find("textarea").val().replace(/\n\r?/g,"<br>"),i.cars[n].price=t.find(".price").find("textarea").val().replace(/\n\r?/g,"<br>"),i.cars[n].date=t.find(".date").find("textarea").val().replace(/\n\r?/g,"<br>"),i.cars[n].info=t.find(".info").find("textarea").val().replace(/\n\r?/g,"<br>"),i.cars[n].infoAll=t.find(".infoAll").find("textarea").val().replace(/\n\r?/g,"<br>"),i.cars[n].des=t.find(".des").find("textarea").val().replace(/\n\r?/g,"<br>"),$.ajax({url:"https://api.mlab.com/api/1/databases/rhinomotor2017/collections/"+I.nowPage+"/"+i._id.$oid+"?apiKey="+C.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(i),success:function(a){b(I.nowPage,e,I.nowDataBrands)},error:function(a,n,e){console.log("error:",a,n,e)}})):C.wrp.hasClass("press")&&(i.press[n].date=t.find(".date").find("textarea").val().replace(/\n\r?/g,"<br>"),i.press[n].title=t.find(".mainTitle").find("textarea").val().replace(/\n\r?/g,"<br>"),i.press[n].content=t.find(".mainContent").find("textarea").val().replace(/\n\r?/g,"<br>"),$.ajax({url:"https://api.mlab.com/api/1/databases/rhinomotor2017/collections/"+I.nowPage+"/"+i._id.$oid+"?apiKey="+C.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(i),success:function(n){b(I.nowPage,a,I.nowDataBrands)},error:function(a,n,e){console.log("error:",a,n,e)}}))}function c(){var n=$(".addbox .box");if(C.wrp.hasClass("cars")){var t={name:n.find(".addname").val().replace(/\n\r?/g,"<br>"),price:n.find(".addprice").val().replace(/\n\r?/g,"<br>"),date:n.find(".adddate").val().replace(/\n\r?/g,"<br>"),info:n.find(".addinfo").val().replace(/\n\r?/g,"<br>"),infoAll:n.find(".addinfoAll").val().replace(/\n\r?/g,"<br>"),des:n.find(".adddes").val().replace(/\n\r?/g,"<br>")};if(!p(t))return alert(C.creatUsererrortxt),void j(!1);t.equipped=[],t.carsImg=[I.defaultCarsImg],t.recommend=!1,j(!0),T(".addbox");var i=I.nowData[I.nowDataBrands];i.cars.push(t),$.ajax({url:"https://api.mlab.com/api/1/databases/rhinomotor2017/collections/"+I.nowPage+"/"+i._id.$oid+"?apiKey="+C.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(i),success:function(a){alert("新增成功"),b(I.nowPage,e,I.nowDataBrands)},error:function(a,n,e){console.log("error:",a,n,e)}})}else if(C.wrp.hasClass("press")){var t={date:n.find(".addDate").val().replace(/\n\r?/g,"<br>"),title:n.find(".addTitle").val().replace(/\n\r?/g,"<br>"),content:n.find(".addContent").val().replace(/\n\r?/g,"<br>")};if(!p(t))return alert(C.creatUsererrortxt),void j(!1);t.photo=[I.defaultPressImg],t.recommend=!1,j(!0),T(".addbox");var i=I.nowData[I.nowDataBrands];i.press.push(t),$.ajax({url:"https://api.mlab.com/api/1/databases/rhinomotor2017/collections/"+I.nowPage+"/"+i._id.$oid+"?apiKey="+C.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(i),success:function(n){alert("新增成功"),b(I.nowPage,a,I.nowDataBrands)},error:function(a,n,e){console.log("error:",a,n,e)}})}}function d(n){if(j(!0),C.wrp.hasClass("cars")){var t=I.nowData[I.nowDataBrands];t.cars.splice(n,1),$.ajax({url:"https://api.mlab.com/api/1/databases/rhinomotor2017/collections/"+I.nowPage+"/"+t._id.$oid+"?apiKey="+C.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(t),success:function(a){b(I.nowPage,e,I.nowDataBrands)},error:function(a,n,e){console.log("error:",a,n,e)}})}else if(C.wrp.hasClass("press")){var t=I.nowData[I.nowDataBrands];t.press.splice(n,1),$.ajax({url:"https://api.mlab.com/api/1/databases/rhinomotor2017/collections/"+I.nowPage+"/"+t._id.$oid+"?apiKey="+C.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(t),success:function(n){b(I.nowPage,a,I.nowDataBrands)},error:function(a,n,e){console.log("error:",a,n,e)}})}}function p(a){var n=!0;for(var e in a)""==a[e]&&(n=!1);return n}function f(a){if(a.files&&a.files[0]){var n=new FileReader;n.onload=function(a){I.UploadImg=a.target.result.replace(/.*,/,"")},n.readAsDataURL(a.files[0])}}function m(a,n){$.ajax({url:"https://api.imgur.com/3/image",method:"POST",headers:{Authorization:"Bearer "+C.imgurToken,Accept:"application/json"},data:{image:a,type:"base64"},success:function(a){I.uploadImgTrue=a.data.link,n()},error:function(a,n,e){console.log("error:",a,n,e),window.location.href="https://api.imgur.com/oauth2/authorize?response_type=token&client_id="+C.imgurappid}})}function u(){if("carsPage"==I.nowPage){var n=I.nowData[I.nowDataBrands];n.cars[I.nowUploadImgNum].carsImg.push(I.uploadImgTrue),$.ajax({url:"https://api.mlab.com/api/1/databases/rhinomotor2017/collections/"+I.nowPage+"/"+n._id.$oid+"?apiKey="+C.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(n),success:function(a){I.uploadImgTrue=I.UploadImg="",alert("新增成功"),b(I.nowPage,e,I.nowDataBrands)},error:function(a,n,e){console.log("error:",a,n,e)}})}if("pressPage"==I.nowPage){var n=I.nowData[I.nowDataBrands];n.press[I.nowUploadImgNum].photo.push(I.uploadImgTrue),$.ajax({url:"https://api.mlab.com/api/1/databases/rhinomotor2017/collections/"+I.nowPage+"/"+n._id.$oid+"?apiKey="+C.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(n),success:function(n){I.uploadImgTrue=I.UploadImg="",alert("新增成功"),b(I.nowPage,a,I.nowDataBrands)},error:function(a,n,e){console.log("error:",a,n,e)}})}}function g(n,t){var i=I.nowData[I.nowDataBrands];"carsPage"==I.nowPage?(i.cars[t].carsImg.splice(n,1),$.ajax({url:"https://api.mlab.com/api/1/databases/rhinomotor2017/collections/"+I.nowPage+"/"+i._id.$oid+"?apiKey="+C.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(i),success:function(a){b(I.nowPage,e,I.nowDataBrands)},error:function(a,n,e){console.log("error:",a,n,e)}})):"carsPage"==I.nowPage&&(i.press[t].photo.splice(n,1),$.ajax({url:"https://api.mlab.com/api/1/databases/rhinomotor2017/collections/"+I.nowPage+"/"+i._id.$oid+"?apiKey="+C.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(i),success:function(n){b(I.nowPage,a,I.nowDataBrands)},error:function(a,n,e){console.log("error:",a,n,e)}}))}function h(a,n){if("carsPage"==I.nowPage){var t=I.nowData[I.nowDataBrands];t.cars[a].equipped.push(n)}$.ajax({url:"https://api.mlab.com/api/1/databases/rhinomotor2017/collections/"+I.nowPage+"/"+t._id.$oid+"?apiKey="+C.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(t),success:function(a){alert("新增成功"),b(I.nowPage,e,I.nowDataBrands)},error:function(a,n,e){console.log("error:",a,n,e)}})}function v(a,n){if("carsPage"==I.nowPage){var t=I.nowData[I.nowDataBrands];t.cars[n].equipped.splice(a,1)}$.ajax({url:"https://api.mlab.com/api/1/databases/rhinomotor2017/collections/"+I.nowPage+"/"+t._id.$oid+"?apiKey="+C.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(t),success:function(a){b(I.nowPage,e,I.nowDataBrands)},error:function(a,n,e){console.log("error:",a,n,e)}})}function w(n){var t=I.nowData[I.nowDataBrands];C.wrp.hasClass("cars")?(t.cars[n].recommend?t.cars[n].recommend=!1:t.cars[n].recommend=!0,$.ajax({url:"https://api.mlab.com/api/1/databases/rhinomotor2017/collections/"+I.nowPage+"/"+t._id.$oid+"?apiKey="+C.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(t),success:function(a){b(I.nowPage,e,I.nowDataBrands)},error:function(a,n,e){console.log("error:",a,n,e)}})):C.wrp.hasClass("press")&&(t.press[n].recommend?t.press[n].recommend=!1:t.press[n].recommend=!0,$.ajax({url:"https://api.mlab.com/api/1/databases/rhinomotor2017/collections/"+I.nowPage+"/"+t._id.$oid+"?apiKey="+C.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(t),success:function(n){b(I.nowPage,a,I.nowDataBrands)},error:function(a,n,e){console.log("error:",a,n,e)}}))}function b(a,n,e){$.ajax({url:"https://api.mlab.com/api/1/databases/rhinomotor2017/collections/"+a+'?s={"_id":-1}&apiKey='+C.mlabApikey,type:"GET",contentType:"application/json",success:function(a){e||(e=0),n(a,e)},error:function(a,n,e){console.log("error:",a,n,e)}})}function y(a){var n=a.height();a.parent().hasClass("on")?a.parent().removeClass("on"):(a.parent().addClass("on"),n=a.height()+a.parent().find(".box").outerHeight(!0)),a.parent().css("height",n)}function D(a){window.location.href=a.attr("data-page")+"#access_token="+window.location.href.split("#access_token=")[1]}function P(){$.cookie("useraccount",""),$.cookie("userpassword",""),window.location.href="index.html"}function B(){var a=!1;return $.cookie("useraccount")&&$.cookie("userpassword")&&(a=!0),a}function T(a){$(a+" input").val(""),$(a+" textarea").val("")}function j(a){a?$(".loading").fadeIn():($(".loading").hasClass("on")||$(".loading").addClass("on"),$(".loading").fadeOut())}var C={};C.wrp=$(".wrapper"),C.mlabApikey="n6FXodWWCdM14KrePZHrRPPovbzboRn6",C.imgurappid="4dd8fdf80527e2a",C.creatUsererrortxt="請填寫完整資料",C.motifyerrortxt="上一筆資料還在修改中，請先完成上一筆修改再繼續。";var I={wrp:$(".wrapper"),defaultCarsImg:"https://ml-andy.github.io/RhinoMotor/andy/images/cars_content_pic1.jpg",defaultPressImg:"https://ml-andy.github.io/RhinoMotor/andy/images/press_b_slide1.jpg",UploadImg:""};try{C.nowpage=getUrlVars().page.replace("#access_token","")}catch(U){C.nowpage=1}C.wrp.hasClass("cars")?(I.nowPage="carsPage",b(I.nowPage,e)):C.wrp.hasClass("press")?(I.nowPage="pressPage",b(I.nowPage,a)):j(!1),$(".logoutbtn").click(function(){P()}),$(".menua").click(function(){D($(this))}),$(".searchbox .submit").click(function(){j(!0);var a=$(".searchbox .addBrands").val();""!=a||void 0!=a?o(I.nowPage,a):(alert(C.creatUsererrortxt),j(!1))}),$(".deleteBrands").click(function(){window.confirm("確定刪除嗎?")&&r(I.nowPage,I.nowDataBrands)}),$(".addbox .submit").click(function(){c()}),$(window).load(function(){if(B())try{C.imgurToken=window.location.href.split("#")[1].split("&")[0].replace("access_token=",""),$(".userMenu .icon").html($.cookie("useraccount").substring(0,1)),$(".userMenu .name").html($.cookie("username"))}catch(a){window.location.href="https://api.imgur.com/oauth2/authorize?response_type=token&client_id="+C.imgurappid}else window.location.href="index.html"+window.location.hash})});