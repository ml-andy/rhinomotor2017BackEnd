function getUrlVars(){for(var a,n=[],e=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),i=0;i<e.length;i++)a=e[i].split("="),n.push(a[0]),n[a[0]]=a[1];return n}$(document).ready(function(){function a(a){var n=a.height();a.parent().hasClass("on")?a.parent().removeClass("on"):(a.parent().addClass("on"),n=a.height()+a.parent().find(".box").outerHeight(!0)),a.parent().css("height",n)}function n(n,s){u.nowData=n,m.motifyPapering=!1,$(".menua.on").replaceWith('<li><span>產品介紹</span><div class="box"></div></li>'),$(".menu ul li .box").html("");for(i in n)$(".menu ul li .box").append('<a class="menuain" href="javascript:;" data-brands="'+i+'">'+n[i].brands+"</a>");u.menulispan=$(".wrapper .menu li").find("span"),u.menulispan.click(function(){a($(this))}),u.menulispan.parent().hasClass("on")||u.menulispan.trigger("click"),u.menulia=$(".wrapper .menu li").find("a"),u.menulia.click(function(){e($(this).attr("data-brands"))}),$(".searchbox .submit").click(function(){f(!0);var a=$(".searchbox .addBrands").val();console.log($(".searchbox .addBrands").val()),""!=a||void 0!=a?t(u.nowPage,a):(alert(m.creatUsererrortxt),f(!1))}),$(".deleteBrands").click(function(){window.confirm("確定刪除嗎?")&&r(u.nowPage,u.nowDataBrands)}),e(s)}function e(a){var n=u.nowData;u.nowDataBrands=a,$(".title").html(n[a].brands+" 產品介紹"),u.cot=$(".content .list ul"),u.cot.html("");for(k in n[u.nowDataBrands].cars){u.cot.append('<li><div class="mainData"><div class="slbox">'+k+'</div><div class="column name">'+n[u.nowDataBrands].cars[k].name+'</div><div class="column price">'+n[u.nowDataBrands].cars[k].price+'</div><div class="column date">'+n[u.nowDataBrands].cars[k].date+'</div><div class="column info">'+n[u.nowDataBrands].cars[k].info+'</div><div class="column infoAll">'+n[u.nowDataBrands].cars[k].infoAll+'</div><div class="column des">'+n[u.nowDataBrands].cars[k].des+'</div><div class="function"><a class="motify" href="javascript:;"></a><a class="delete" href="javascript:;"></a></div></div><div class="secData"></div></li>'),u.cot.find("li:last .secData").append('<div class="eqi"><div class="st">配備</div></div>');for(x in n[u.nowDataBrands].cars[k].equipped)u.cot.find("li:last .secData .eqi").append('<div class="equData"><span>'+n[u.nowDataBrands].cars[k].equipped[x]+'</span><div class="btn"><a href="javascript:;" class="modify">修改</a><a href="javascript:;" class="delet">刪除</a></div></div>');var e="否";n[u.nowDataBrands].cars[k].recommend&&(e="是"),u.cot.find("li:last .secData").append('<div class="recommend" data-recd="'+n[u.nowDataBrands].cars[k].recommend+'"><div class="st">推薦</div><span>'+e+'</span><div class="btn change">更改</div></div>'),u.cot.find("li:last .secData").append('<div class="carsImg"><div class="st">圖片</div></div>');for(x in n[u.nowDataBrands].cars[k].carsImg)u.cot.find("li:last .secData .carsImg").append('<div class="photoData"><div class="photo"><img src="'+n[u.nowDataBrands].cars[k].carsImg[x]+'"></div><div class="btn"><a href="javascript:;" class="modify">修改</a><a href="javascript:;" class="delet">刪除</a></div></div>')}$(".function .motify").click(function(){$(this).hasClass("on")?($(this).removeClass("on"),o($(this).parent().parent().find(".slbox").text())):($(this).addClass("on"),s(!0,$(this).parent().parent().find(".slbox").text()))}),$(".function .delete").click(function(){$(this).parent().find(".motify").hasClass("on")?($(this).parent().find(".motify").removeClass("on"),s(!1,$(this).parent().parent().find(".slbox").text())):window.confirm("確定刪除嗎?")&&l($(this).parent().parent().find(".slbox").text())}),$(".menu ul li .box a").removeClass("on").eq(u.nowDataBrands).addClass("on"),f(!1)}function t(a,n){var e={brands:n,cars:[]};$.ajax({url:"https://api.mlab.com/api/1/databases/rhinomotor2017/collections/"+a+"?apiKey="+m.mlabApikey,type:"POST",contentType:"application/json",data:JSON.stringify(e),success:function(a){alert("新增成功"),window.location.reload()},error:function(a,n,e){_o.removeClass("on"),showloading(!1),console.log("error:",a,n,e)}})}function r(a,n){f(!0),$.ajax({url:"https://api.mlab.com/api/1/databases/rhinomotor2017/collections/"+a+"/"+u.nowData[n]._id.$oid+"?apiKey="+m.mlabApikey,type:"DELETE",async:!0,timeout:3e5,contentType:"application/json",success:function(a){location.reload()},error:function(a,n,e){console.log("error:",a,n,e)}})}function s(a,n,e){var i=$(".list").find("li").eq(n);if(a){if(m.motifyPapering)return alert(m.motifyerrortxt),void i.find(".motify").removeClass("on");m.motifyPapering=!0}else m.motifyPapering=!1;if(m.wrp.hasClass("cars")){var i=$(".list").find("li").eq(n);a?(i.find(".name").html("<textarea>"+i.find(".name").html().replace(/<br>/g,"\n")+"</textarea>"),i.find(".price").html("<textarea>"+i.find(".price").html().replace(/<br>/g,"\n")+"</textarea>"),i.find(".date").html("<textarea>"+i.find(".date").html().replace(/<br>/g,"\n")+"</textarea>"),i.find(".info").html("<textarea>"+i.find(".info").html().replace(/<br>/g,"\n")+"</textarea>"),i.find(".infoAll").html("<textarea>"+i.find(".infoAll").html().replace(/<br>/g,"\n")+"</textarea>"),i.find(".des").html("<textarea>"+i.find(".des").html().replace(/<br>/g,"\n")+"</textarea>")):(i.find(".name").html(i.find(".name textarea").val().replace(/\n\r?/g,"<br>")),i.find(".price").html(i.find(".price textarea").val().replace(/\n\r?/g,"<br>")),i.find(".date").html(i.find(".date textarea").val().replace(/\n\r?/g,"<br>")),i.find(".info").html(i.find(".info textarea").val().replace(/\n\r?/g,"<br>")),i.find(".infoAll").html(i.find(".infoAll textarea").val().replace(/\n\r?/g,"<br>")),i.find(".des").html(i.find(".des textarea").val().replace(/\n\r?/g,"<br>")))}}function o(a){if(f(!0),m.wrp.hasClass("cars")){var e=$(".list").find("li").eq(a),i=u.nowData[u.nowDataBrands];i.cars[a].name=e.find(".name").find("textarea").val().replace(/\n\r?/g,"<br>"),i.cars[a].price=e.find(".price").find("textarea").val().replace(/\n\r?/g,"<br>"),i.cars[a].date=e.find(".date").find("textarea").val().replace(/\n\r?/g,"<br>"),i.cars[a].info=e.find(".info").find("textarea").val().replace(/\n\r?/g,"<br>"),i.cars[a].infoAll=e.find(".infoAll").find("textarea").val().replace(/\n\r?/g,"<br>"),i.cars[a].des=e.find(".des").find("textarea").val().replace(/\n\r?/g,"<br>"),$.ajax({url:"https://api.mlab.com/api/1/databases/rhinomotor2017/collections/"+u.nowPage+"/"+i._id.$oid+"?apiKey="+m.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(i),success:function(a){c(u.nowPage,n,u.nowDataBrands)},error:function(a,n,e){console.log("error:",a,n,e)}})}}function l(a){if(f(!0),m.wrp.hasClass("cars")){var e=u.nowData[u.nowDataBrands];e.cars.splice(a,1),$.ajax({url:"https://api.mlab.com/api/1/databases/rhinomotor2017/collections/"+u.nowPage+"/"+e._id.$oid+"?apiKey="+m.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(e),success:function(a){c(u.nowPage,n,u.nowDataBrands)},error:function(a,n,e){console.log("error:",a,n,e)}})}}function c(a,n,e){$.ajax({url:"https://api.mlab.com/api/1/databases/rhinomotor2017/collections/"+a+'?s={"_id":-1}&apiKey='+m.mlabApikey,type:"GET",contentType:"application/json",success:function(a){e||(e=0),n(a,e)},error:function(a,n,e){console.log("error:",a,n,e)}})}function d(a){window.location.href=a.attr("data-page")+"#access_token="+window.location.href.split("#access_token=")[1]}function p(){var a=!1;return $.cookie("useraccount")&&$.cookie("userpassword")&&(a=!0),a}function f(a){a?$(".loading").fadeIn():($(".loading").hasClass("on")||$(".loading").addClass("on"),$(".loading").fadeOut())}var m={};m.wrp=$(".wrapper"),m.mlabApikey="n6FXodWWCdM14KrePZHrRPPovbzboRn6",m.imgurappid="4dd8fdf80527e2a",m.creatUsererrortxt="請填寫完整資料",m.motifyerrortxt="上一筆資料還在修改中，請先完成上一筆修改再繼續。";var u={wrp:$(".wrapper")};try{m.nowpage=getUrlVars().page.replace("#access_token","")}catch(h){m.nowpage=1}m.wrp.hasClass("cars")?(u.nowPage="carsPage",c(u.nowPage,n)):f(!1),$(".menua").click(function(){d($(this))}),$(window).load(function(){if(p())try{m.imgurToken=window.location.href.split("#")[1].split("&")[0].replace("access_token=",""),$(".userMenu .icon").html($.cookie("useraccount").substring(0,1)),$(".userMenu .name").html($.cookie("username"))}catch(a){window.location.href="https://api.imgur.com/oauth2/authorize?response_type=token&client_id="+m.imgurappid}else window.location.href="index.html"+window.location.hash})});