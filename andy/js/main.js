function getUrlVars(){for(var a,e=[],t=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),n=0;n<t.length;n++)a=t[n].split("="),e.push(a[0]),e[a[0]]=a[1];return e}$(document).ready(function(){function a(a){var e=a.height();a.parent().hasClass("on")?a.parent().removeClass("on"):(a.parent().addClass("on"),e=a.height()+a.parent().find(".box").outerHeight(!0)),a.parent().css("height",e)}function e(a){if(U(!0),"banner"==a){if(!M.indexbanneruploadImg)return alert("請新增一張圖片"),void U(!1);C(M.indexbanneruploadImg,t)}else if("photo"==a){if(!M.indexphotouploadImg)return alert("請新增一張圖片"),void U(!1);C(M.indexphotouploadImg,n)}}function t(){M.insertdata={pic:M.uploadImgTrue},$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/index_banner"+M.nowpage+"?apiKey="+M.mlabApikey,type:"POST",contentType:"application/json",data:JSON.stringify(M.insertdata),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})}function n(){M.insertdata={pic:M.uploadImgTrue},$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/index_photo"+M.nowpage+"?apiKey="+M.mlabApikey,type:"POST",contentType:"application/json",data:JSON.stringify(M.insertdata),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})}function s(){if(M.indexload+=1,!(M.indexload<3)){for(var a=0;a<M.learndata.length;a++)if("index_banner"==M.learndata[a].collectname){$(".paper.banner").attr("num",a);for(var e=0;e<M.learndata[a].length;e++)$(".paper.banner").append('<li><div class="postphoto"><img src="'+M.learndata[a][e].pic+'"></div><div class="btn" item="'+e+'" num="'+a+'"><div title="修改" class="motify"></div><div title="刪除" class="delbtn"></div></div></li>')}else if("index_photo"==M.learndata[a].collectname){$(".paper.photo").attr("num",a);for(var e=0;e<M.learndata[a].length;e++)$(".paper.photo").append('<li><div class="postphoto"><img src="'+M.learndata[a][e].pic+'"></div><div class="btn" item="'+e+'" num="'+a+'"><div title="修改" class="motify"></div><div title="刪除" class="delbtn"></div></div></li>')}else if("index_video"==M.learndata[a].collectname){$(".paper.video").attr("num",a);for(var e=0;e<M.learndata[a].length;e++)$(".paper.video").append('<li><div class="posttitle"><a href="'+M.learndata[a][e].video+'" target="blank">'+M.learndata[a][e].video+'</a></div><div class="btn" item="'+e+'" num="'+a+'"><div title="修改" class="motify"></div></div></li>')}o()}}function o(){$(".paper .delbtn").click(function(){$(this).parent().find(".motify").hasClass("on")?($(this).parent().find(".motify").removeClass("on"),m(!1,$(this).parent().attr("item"),$(this).parent().attr("num"))):g($(this).parent().attr("item"),$(this).parent().attr("num"))}),$(".paper .motify").click(function(){$(this).hasClass("on")?($(this).removeClass("on"),f($(this).parent().attr("item"),$(this).parent().attr("num"))):($(this).addClass("on"),m(!0,$(this).parent().attr("item"),$(this).parent().attr("num")))}),$(".menuin a").removeClass("on").eq(0).addClass("on"),U(!1)}function r(){if(M.contactload+=1,!(M.contactload<2)){for(var a=0;a<M.learndata.length;a++)if("contactus"==M.learndata[a].collectname)for(var e=0;e<M.learndata[a].length;e++)$(".paper_addr").append('<li><div class="posttitle">'+M.learndata[a][e].addr+'</div><div class="btn" item="'+e+'" num="'+a+'"><div title="修改" class="motify"></div><div title="刪除" class="delbtn"></div></div></li>');else if("emailbox"==M.learndata[a].collectname)for(var e=0;e<M.learndata[a].length;e++)$(".paper_mail").append('<li><div class="contact_name">'+M.learndata[a][e].username+'</div><div class="contact_phone">'+M.learndata[a][e].userphone+'</div><div class="contact_email">'+M.learndata[a][e].useremail+'</div><div class="contact_des">'+M.learndata[a][e].userword+'</div><div class="contact_date">'+M.learndata[a][e].postdate+'</div><div class="btn" item="'+e+'" num="'+a+'"><div title="刪除" class="delbtn"></div></div></li>');l()}}function l(){$(".paper_addr .delbtn").click(function(){$(this).parent().find(".motify").hasClass("on")?($(this).parent().find(".motify").removeClass("on"),m(!1,$(this).parent().attr("item"),$(this).parent().attr("num"))):alert("地址是必要資料，無法刪除。")}),$(".paper_addr .motify").click(function(){$(this).hasClass("on")?($(this).removeClass("on"),f($(this).parent().attr("item"),$(this).parent().attr("num"))):($(this).addClass("on"),m(!0,$(this).parent().attr("item")))}),$(".paper_mail .delbtn").click(function(){var a=confirm("確定刪除留言嗎?");1==a&&g($(this).parent().attr("item"),$(this).parent().attr("num"))}),$(".menuin a").removeClass("on").eq(6).addClass("on"),U(!1)}function p(){return M.insertdata={title:$(".addgame .posttitle").val().replace(/\n\r?/g,"<br>"),list:[]},M.insertdata.title?(U(!0),void $.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/awards"+M.nowpage+"?apiKey="+M.mlabApikey,type:"POST",contentType:"application/json",data:JSON.stringify(M.insertdata),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})):void alert(M.creatUsererrortxt)}function c(a){$(".paper").html("");for(i in M.newPaperdata)M.newPaperdata[i].bpic||(M.newPaperdata[i].bpic="images/space.png"),M.newPaperdata[i].spic||(M.newPaperdata[i].spic="images/space.png"),$(".paper").append('<li><div class="newsbpic"><img src="'+M.newPaperdata[i].bpic+'"></div><div class="newsspic"><img src="'+M.newPaperdata[i].spic+'"></div><div class="newstitle">'+M.newPaperdata[i].title+'</div><div class="newssword">'+M.newPaperdata[i].sword+'</div><div class="newsbword">'+M.newPaperdata[i].bword+'</div><div class="btn"><div title="修改" class="motify"></div><div title="刪除" class="delbtn"></div></div></li>');d()}function d(){$(".paper .delbtn").click(function(){$(this).parent().find(".motify").hasClass("on")?($(this).parent().find(".motify").removeClass("on"),m(!1,$(this).parent().parent().index())):g($(this).parent().parent().index())}),$(".paper .motify").click(function(){$(this).hasClass("on")?($(this).removeClass("on"),f($(this).parent().parent().index())):($(this).addClass("on"),m(!0,$(this).parent().parent().index()))}),$(".menuin a").removeClass("on").eq(2).addClass("on"),U(!1)}function u(e){$(".menua.on").replaceWith('<li><span>產品介紹</span><div class="box"></div></li>');for(i in e)$(".menu ul li .box").append('<a class="menuain" href="javascript:;" data-brands="'+i+'">'+e[i].brands+"</a>");S.nowDataBrands=0,S.menulispan=$(".wrapper .menu li").find("span"),S.menulispan.click(function(){a($(this))}),S.menulispan.trigger("click"),S.cot=$(".content .list ul"),S.cot.html("");for(j in e)for(k in e[j].cars){S.cot.append('<li><div class="mainData"><div class="slbox">'+k+'</div><div class="column name">'+e[j].cars[k].name+'</div><div class="column price">'+e[j].cars[k].price+'</div><div class="column date">'+e[j].cars[k].date+'</div><div class="column info">'+e[j].cars[k].info+'</div><div class="column infoAll">'+e[j].cars[k].infoAll+'</div><div class="column des">'+e[j].cars[k].des+'</div><div class="function"><a href="javascript:;">修改</a><a href="javascript:;">刪除</a></div></div><div class="secData"></div></li>'),S.cot.find("li:last .secData").append('<div class="eqi"><div class="st">配備</div></div>');for(x in e[j].cars[k].equipped)S.cot.find("li:last .secData .eqi").append('<div class="equData"><span>'+e[j].cars[k].equipped[x]+'</span><div class="btn"><a href="javascript:;" class="modify">修改</a><a href="javascript:;" class="delet">刪除</a></div></div>');var t="否";e[j].cars[k].recommend&&(t="是"),S.cot.find("li:last .secData").append('<div class="recommend" data-recd="'+e[j].cars[k].recommend+'"><div class="st">推薦</div><span>'+t+'</span><div class="btn change">更改</div></div>'),S.cot.find("li:last .secData").append('<div class="carsImg"><div class="st">圖片</div></div>');for(x in e[j].cars[k].carsImg)S.cot.find("li:last .secData .carsImg").append('<div class="photoData"><div class="photo"><img src="'+e[j].cars[k].carsImg[x]+'"></div><div class="btn"><a href="javascript:;" class="modify">修改</a><a href="javascript:;" class="delet">刪除</a></div></div>')}U(!1)}function m(a,e,t){if(a){if(M.motifyPapering){if(alert(M.motifyerrortxt),t)for(var n=0;n<$("ul").length;n++)$("ul").eq(n).attr("num")==t&&$("ul").eq(n).find("li").eq(e).find(".motify").removeClass("on");else $("ul li").eq(e).find(".motify").removeClass("on");return}M.motifyPapering=!0}else M.motifyPapering=!1;if(M.wrp.hasClass("about")){var i=$(".paper").eq(t).find("li").eq(e);a?(i.find(".posttitle").html("<textarea>"+i.find(".posttitle").html().replace(/<br>/g,"\n")+"</textarea>"),i.find(".postdes").html("<textarea>"+i.find(".postdes").html().replace(/<br>/g,"\n")+"</textarea>"),i.find(".postphoto").prepend('<input type="file" name="file" id="imgInputMotify" accept="image/*" capture="camera"><label class="imgInputlabel" for="imgInputMotify"><span>點擊更換</span></label>'),$("#imgInputMotify").change(function(){v(this,$(this))})):(i.find(".posttitle").html(i.find(".posttitle textarea").val().replace(/\n\r?/g,"<br>")),i.find(".postdes").html(i.find(".postdes textarea").val().replace(/\n\r?/g,"<br>")),i.find(".postphoto").html('<img src="'+M.newPaperdata[0].list[e].pic+'">'))}else if(M.wrp.hasClass("news")){var i=$(".paper").find("li").eq(e);a?(i.find(".newstitle").html("<textarea>"+i.find(".newstitle").html().replace(/<br>/g,"\n")+"</textarea>"),i.find(".newsbword").html("<textarea>"+i.find(".newsbword").html().replace(/<br>/g,"\n")+"</textarea>"),i.find(".newssword").html("<textarea>"+i.find(".newssword").html().replace(/<br>/g,"\n")+"</textarea>"),i.find(".newsbpic").prepend('<input type="file" name="file" id="imgInputMotify" accept="image/*" capture="camera"><label class="imgInputlabel" for="imgInputMotify"><span>點擊更換</span></label>'),$("#imgInputMotify").change(function(){v(this,$(this),0)}),i.find(".newsspic").prepend('<input type="file" name="file" id="imgInputMotify2" accept="image/*" capture="camera"><label class="imgInputlabel" for="imgInputMotify2"><span>點擊更換</span></label>'),$("#imgInputMotify2").change(function(){v(this,$(this),1)})):(i.find(".newstitle").html(i.find(".newstitle textarea").val().replace(/\n\r?/g,"<br>")),i.find(".newsbword").html(i.find(".newsbword textarea").val().replace(/\n\r?/g,"<br>")),i.find(".newssword").html(i.find(".newssword textarea").val().replace(/\n\r?/g,"<br>")),i.find(".newsbpic").html('<img src="'+M.newPaperdata[e].bpic+'">'),i.find(".newsspic").html('<img src="'+M.newPaperdata[e].spic+'">'))}else if(M.wrp.hasClass("learn")){var i=$(".paper").eq(t).find("li").eq(e);a?(0==t&&(i.find(".posttitle").html("<textarea>"+i.find(".posttitle").html().replace(/<br>/g,"\n")+"</textarea>"),i.find(".postdes").html("<textarea>"+i.find(".postdes").html().replace(/<br>/g,"\n")+"</textarea>")),i.find(".postphoto").prepend('<input type="file" name="file" id="imgInputMotify" accept="image/*" capture="camera"><label class="imgInputlabel" for="imgInputMotify"><span>點擊更換</span></label>'),$("#imgInputMotify").change(function(){v(this,$(this))})):i.find(".postphoto").html('<img src="'+M.learndata[1][e].pic+'">')}else if(M.wrp.hasClass("link")){var i=$(".paper li").eq(e);a?(i.find(".posttitle").html("<textarea>"+i.find(".posttitle a").html()+"</textarea>"),i.find(".postphoto").prepend('<input type="file" name="file" id="imgInputMotify" accept="image/*" capture="camera"><label class="imgInputlabel" for="imgInputMotify"><span>點擊更換</span></label>'),$("#imgInputMotify").change(function(){v(this,$(this))})):(i.find(".posttitle").html('<a href="'+M.newPaperdata[e].link+'">'+M.newPaperdata[e].link+"</a>"),i.find(".postphoto").html('<img src="'+M.newPaperdata[e].pic+'">'))}else if(M.wrp.hasClass("contact"))a?$(".paper_addr li").eq(e).find(".posttitle").html("<textarea>"+$(".paper_addr li").eq(e).find(".posttitle").html().replace(/<br>/g,"\n")+"</textarea>"):$(".paper_addr li").eq(e).find(".posttitle").html(M.learndata[t][e].addr);else if(M.wrp.hasClass("index"))if("index_banner"==M.learndata[t].collectname){var i=$(".paper.banner li").eq(e);a?(i.find(".postphoto").prepend('<input type="file" name="file" id="imgInputMotify" accept="image/*" capture="camera"><label class="imgInputlabel" for="imgInputMotify"><span>點擊更換</span></label>'),$("#imgInputMotify").change(function(){v(this,$(this),0)})):i.find(".postphoto").html('<img src="'+M.learndata[t][e].pic+'">')}else if("index_photo"==M.learndata[t].collectname){var i=$(".paper.photo li").eq(e);a?(i.find(".postphoto").prepend('<input type="file" name="file" id="imgInputMotify2" accept="image/*" capture="camera"><label class="imgInputlabel" for="imgInputMotify2"><span>點擊更換</span></label>'),$("#imgInputMotify2").change(function(){v(this,$(this),1)})):i.find(".postphoto").html('<img src="'+M.learndata[t][e].pic+'">')}else if("index_video"==M.learndata[t].collectname){var i=$(".paper.video li").eq(e);a?i.find(".posttitle").html("<textarea>"+i.find(".posttitle a").html()+"</textarea>"):i.find(".posttitle").html('<a href="'+M.learndata[t][e].video+'">'+M.learndata[t][e].video+"</a>")}}function f(a,e){U(!0),M.wrp.hasClass("about")?(M._n=a,M._num=e,$(".paper").eq(e).find("li").eq(a).find(".postphoto").find("img").hasClass("on")?C(M.uploadImg,h):(M.uploadImgTrue=$(".paper").eq(e).find("li").eq(a).find(".postphoto").find("img").attr("src"),h())):M.wrp.hasClass("news")?(M._n=a,M.newspiccheck=0,$(".paper").find("li").eq(a).find(".newsbpic").find("img").hasClass("on")?C(M.uploadImgbpic,h,0):(M.newspiccheck+=1,M.uploadImgbpic=$(".paper").find("li").eq(a).find(".newsbpic").find("img").attr("src")),$(".paper").find("li").eq(a).find(".newsspic").find("img").hasClass("on")?C(M.uploadImgspic,h,1):(M.newspiccheck+=1,M.uploadImgspic=$(".paper").find("li").eq(a).find(".newsspic").find("img").attr("src")),h()):M.wrp.hasClass("learn")?(M._n=a,M._num=e,$(".paper").eq(e).find("li").eq(a).find(".postphoto").find("img").hasClass("on")?C(M.uploadImg,h):(M.uploadImgTrue=$(".paper").eq(e).find("li").eq(a).find(".postphoto").find("img").attr("src"),h())):M.wrp.hasClass("link")?(M._n=a,$(".paper li").eq(a).find(".postphoto").find("img").hasClass("on")?C(M.uploadImg,h):(M.uploadImgTrue=$(".paper li").eq(a).find(".postphoto").find("img").attr("src"),h())):M.wrp.hasClass("contact")?(M._n=a,M._num=e,h()):M.wrp.hasClass("index")&&(M._n=a,M._num=e,"index_banner"==M.learndata[M._num].collectname?$(".paper.banner li").eq(M._n).find(".postphoto").find("img").hasClass("on")?C(M.uploadImgindexbannerpic,h):(M.uploadImgTrue=$(".paper.banner li").eq(M._n).find(".postphoto").find("img").attr("src"),h()):"index_photo"==M.learndata[M._num].collectname?$(".paper.photo li").eq(M._n).find(".postphoto").find("img").hasClass("on")?C(M.uploadImgindexphotopic,h):(M.uploadImgTrue=$(".paper.photo li").eq(M._n).find(".postphoto").find("img").attr("src"),h()):"index_video"==M.learndata[M._num].collectname&&h())}function h(){if(M.wrp.hasClass("about"))0==M._num?(M.newPaperdata[0].title=$(".paper").eq(M._num).find("li").eq(M._n).find(".posttitle").find("textarea").val().replace(/\n\r?/g,"<br>"),M.newPaperdata[0].info=$(".paper").eq(M._num).find("li").eq(M._n).find(".postdes").find("textarea").val().replace(/\n\r?/g,"<br>"),M.newPaperdata[0].cover=M.uploadImgTrue):1==M._num&&(M.newPaperdata[0].list[M._n].name=$(".paper").eq(M._num).find("li").eq(M._n).find(".posttitle").find("textarea").val().replace(/\n\r?/g,"<br>"),M.newPaperdata[0].list[M._n].des=$(".paper").eq(M._num).find("li").eq(M._n).find(".postdes").find("textarea").val().replace(/\n\r?/g,"<br>"),M.newPaperdata[0].list[M._n].pic=M.uploadImgTrue),$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/aboutus_page"+M.nowpage+"?apiKey="+M.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(M.newPaperdata),success:function(a){T("aboutus_page",aboutfunction)},error:function(a,e,t){console.log("error:",a,e,t)}});else if(M.wrp.hasClass("news")){if(M.newspiccheck<2)return;M.newPaperdata[M._n].title=$(".paper").find("li").eq(M._n).find(".newstitle").find("textarea").val().replace(/\n\r?/g,"<br>"),M.newPaperdata[M._n].spic=M.uploadImgspic,M.newPaperdata[M._n].bpic=M.uploadImgbpic,M.newPaperdata[M._n].date=(new Date).getFullYear()+"/"+(1*(new Date).getMonth()+1)+"/"+(new Date).getDate()+"星期"+q((new Date).getDay()),M.newPaperdata[M._n].sword=$(".paper").find("li").eq(M._n).find(".newssword").find("textarea").val().replace(/\n\r?/g,"<br>"),M.newPaperdata[M._n].bword=$(".paper").find("li").eq(M._n).find(".newsbword").find("textarea").val().replace(/\n\r?/g,"<br>"),$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/news_page"+M.nowpage+"/"+M.newPaperdata[M._n]._id.$oid+"?apiKey="+M.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(M.newPaperdata[M._n]),success:function(a){T("news_page",c)},error:function(a,e,t){console.log("error:",a,e,t)}})}else if(M.wrp.hasClass("learn"))0==M._num?(M.learndata[0][0].classinfo=$(".paper").eq(M._num).find("li").eq(M._n).find(".posttitle").find("textarea").val().replace(/\n\r?/g,"<br>"),M.learndata[0][0].classdes=$(".paper").eq(M._num).find("li").eq(M._n).find(".postdes").find("textarea").val().replace(/\n\r?/g,"<br>"),M.learndata[0][0].photo=M.uploadImgTrue,M.learndata[0][0].title=M.learndata[0][0].title,console.log(M.learndata[0][0].title),$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/learning_page"+M.nowpage+"?apiKey="+M.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(M.learndata[0]),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})):1==M._num&&(M.learndata[1][M._n].pic=M.uploadImgTrue,$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/learning_photo_page"+M.nowpage+"?apiKey="+M.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(M.learndata[1]),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}}));else if(M.wrp.hasClass("link"))M.newPaperdata[M._n].link=$(".paper li").eq(M._n).find(".posttitle textarea").val(),M.newPaperdata[M._n].pic=M.uploadImgTrue,$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/otherlink"+M.nowpage+"/"+M.newPaperdata[M._n]._id.$oid+"?apiKey="+M.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(M.newPaperdata[M._n]),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}});else if(M.wrp.hasClass("contact")){if(M.learndata[M._num][M._n].addr=$(".paper_addr li").eq(M._n).find(".posttitle textarea").val(),!M.learndata[M._num][M._n].addr)return void alert(M.creatUsererrortxt);$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/contactus"+M.nowpage+"/"+M.learndata[M._num][M._n]._id.$oid+"?apiKey="+M.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(M.learndata[M._num][M._n]),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})}else if(M.wrp.hasClass("index"))if("index_banner"==M.learndata[M._num].collectname)M.learndata[M._num][M._n].pic=M.uploadImgTrue,$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/index_banner"+M.nowpage+"/"+M.learndata[M._num][M._n]._id.$oid+"?apiKey="+M.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(M.learndata[M._num][M._n]),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}});else if("index_photo"==M.learndata[M._num].collectname)M.learndata[M._num][M._n].pic=M.uploadImgTrue,$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/index_photo"+M.nowpage+"/"+M.learndata[M._num][M._n]._id.$oid+"?apiKey="+M.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(M.learndata[M._num][M._n]),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}});else if("index_video"==M.learndata[M._num].collectname){if(M.learndata[M._num][M._n].video=$(".paper.video li").eq(M._n).find(".posttitle textarea").val(),!M.learndata[M._num][M._n].video)return void alert(M.creatUsererrortxt);$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/index_video"+M.nowpage+"/"+M.learndata[M._num][M._n]._id.$oid+"?apiKey="+M.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(M.learndata[M._num][M._n]),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})}}function g(a,e){if(U(!0),M.wrp.hasClass("about"))M.newPaperdata[0].list.splice(a,1),$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/aboutus_page"+M.nowpage+"?apiKey="+M.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(M.newPaperdata),success:function(a){T("aboutus_page",aboutfunction)},error:function(a,e,t){console.log("error:",a,e,t)}});else if(M.wrp.hasClass("news"))$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/news_page"+M.nowpage+"/"+M.newPaperdata[a]._id.$oid+"?apiKey="+M.mlabApikey,type:"DELETE",async:!0,timeout:3e5,contentType:"application/json",success:function(a){T("news_page",c)},error:function(a,e,t){console.log("error:",a,e,t)}});else if(M.wrp.hasClass("learn"))$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/learning_photo_page"+M.nowpage+"/"+M.learndata[e][a]._id.$oid+"?apiKey="+M.mlabApikey,type:"DELETE",async:!0,timeout:3e5,contentType:"application/json",success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}});else if(M.wrp.hasClass("link"))$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/otherlink"+M.nowpage+"/"+M.newPaperdata[a]._id.$oid+"?apiKey="+M.mlabApikey,type:"DELETE",async:!0,timeout:3e5,contentType:"application/json",success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}});else if(M.wrp.hasClass("contact"))$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/emailbox"+M.nowpage+"/"+M.learndata[e][a]._id.$oid+"?apiKey="+M.mlabApikey,type:"DELETE",async:!0,timeout:3e5,contentType:"application/json",success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}});else if(M.wrp.hasClass("index")){var t;"index_banner"==M.learndata[e].collectname?t="https://api.mlab.com/api/1/databases/chinesechess2016/collections/index_banner"+M.nowpage+"/"+M.learndata[e][a]._id.$oid+"?apiKey="+M.mlabApikey:"index_photo"==M.learndata[e].collectname?t="https://api.mlab.com/api/1/databases/chinesechess2016/collections/index_photo"+M.nowpage+"/"+M.learndata[e][a]._id.$oid+"?apiKey="+M.mlabApikey:"index_video"==M.learndata[e].collectname&&(t="https://api.mlab.com/api/1/databases/chinesechess2016/collections/index_video"+M.nowpage+"/"+M.learndata[e][a]._id.$oid+"?apiKey="+M.mlabApikey),$.ajax({url:t,type:"DELETE",async:!0,timeout:3e5,contentType:"application/json",success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})}}function w(a,e,t){if(a.files&&a.files[0]){var n=new FileReader;n.onload=function(a){0==t?M.indexbanneruploadImg=a.target.result.replace(/.*,/,""):M.indexphotouploadImg=a.target.result.replace(/.*,/,""),e.parent().addClass("on").find("img").addClass("on").attr("src",a.target.result)},n.readAsDataURL(a.files[0])}}function b(a,e,t){if(a.files&&a.files[0]){var n=new FileReader;n.onload=function(a){0==t?M.newsuploadImgbpic=a.target.result.replace(/.*,/,""):M.newsuploadImgspic=a.target.result.replace(/.*,/,""),e.parent().addClass("on").find("img").addClass("on").attr("src",a.target.result)},n.readAsDataURL(a.files[0])}}function v(a,e,t){if(M.wrp.hasClass("about")||M.wrp.hasClass("learn")||M.wrp.hasClass("link")){if(a.files&&a.files[0]){var n=new FileReader;n.onload=function(a){M.uploadImg=a.target.result.replace(/.*,/,""),e.parent().addClass("on").find("img").addClass("on").attr("src",a.target.result)},n.readAsDataURL(a.files[0])}}else if(M.wrp.hasClass("news")){if(a.files&&a.files[0]){var n=new FileReader;n.onload=function(a){0==t?M.uploadImgbpic=a.target.result.replace(/.*,/,""):M.uploadImgspic=a.target.result.replace(/.*,/,""),e.parent().addClass("on").find("img").addClass("on").attr("src",a.target.result)},n.readAsDataURL(a.files[0])}}else if(M.wrp.hasClass("index")&&a.files&&a.files[0]){var n=new FileReader;n.onload=function(a){0==t?M.uploadImgindexbannerpic=a.target.result.replace(/.*,/,""):M.uploadImgindexphotopic=a.target.result.replace(/.*,/,""),console.log(e.parent().addClass("on").find("img").addClass("on")),e.parent().addClass("on").find("img").addClass("on").attr("src",a.target.result)},n.readAsDataURL(a.files[0])}}function y(){if(M.wrp.hasClass("about")){if(M.posttitleval=$(".new .posttitle").val(),M.postdesval=$(".new .postdes").val(),!M.posttitleval||!M.postdesval)return void alert(M.creatUsererrortxt);U(!0),M.uploadImg?C(M.uploadImg,_):_()}else if(M.wrp.hasClass("news")){if(M.insertdata={title:$(".new .newstitle").val().replace(/\n\r?/g,"<br>"),date:(new Date).getFullYear()+"/"+(1*(new Date).getMonth()+1)+"/"+(new Date).getDate()+"星期"+q((new Date).getDay()),sword:$(".new .newssword").val().replace(/\n\r?/g,"<br>"),bword:$(".new .newsbword").val().replace(/\n\r?/g,"<br>")},!M.insertdata.title||!M.insertdata.sword||!M.insertdata.bword)return void alert(M.creatUsererrortxt);U(!0),M.newsinsertpiccheck=0,M.newsuploadImgbpic?I(M.newsuploadImgbpic,_,0):(M.newsinsertpiccheck+=1,M.newsuploadImgbpic="images/space.png"),M.newsuploadImgspic?I(M.newsuploadImgspic,_,1):(M.newsinsertpiccheck+=1,M.newsuploadImgspic="images/space.png"),_()}else if(M.wrp.hasClass("learn"))U(!0),M.uploadImg?C(M.uploadImg,_):alert(M.creatUsererrortxt);else if(M.wrp.hasClass("link")){if(U(!0),M.insertdata={link:$(".new .posttitle").val()},!M.insertdata.link)return void alert(M.creatUsererrortxt);M.uploadImg?C(M.uploadImg,_):alert(M.creatUsererrortxt)}}function _(){if(M.wrp.hasClass("about"))M.newPaperdata[0].list.push({name:M.posttitleval.replace(/\n\r?/g,"<br>"),des:M.postdesval.replace(/\n\r?/g,"<br>"),pic:M.uploadImgTrue}),$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/aboutus_page"+M.nowpage+"?apiKey="+M.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(M.newPaperdata),success:function(a){O(),T("aboutus_page",aboutfunction)},error:function(a,e,t){console.log("error:",a,e,t)}});else if(M.wrp.hasClass("news")){if(M.newsinsertpiccheck<2)return;M.insertdata.bpic=M.newsuploadImgbpic,M.insertdata.spic=M.newsuploadImgspic,$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/news_page"+M.nowpage+"?apiKey="+M.mlabApikey,type:"POST",contentType:"application/json",data:JSON.stringify(M.insertdata),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})}else M.wrp.hasClass("learn")?(M.insertdata={pic:M.uploadImgTrue},$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/learning_photo_page"+M.nowpage+"?apiKey="+M.mlabApikey,type:"POST",contentType:"application/json",data:JSON.stringify(M.insertdata),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})):M.wrp.hasClass("link")&&(M.insertdata.pic=M.uploadImgTrue,$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/otherlink"+M.nowpage+"?apiKey="+M.mlabApikey,type:"POST",contentType:"application/json",data:JSON.stringify(M.insertdata),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}}))}function I(a,e,t){$.ajax({url:"https://api.imgur.com/3/image",method:"POST",headers:{Authorization:"Bearer "+M.imgurToken,Accept:"application/json"},data:{image:a,type:"base64"},success:function(a){M.wrp.hasClass("news")&&(M.newsinsertpiccheck+=1,0==t?M.newsuploadImgbpic=a.data.link:M.newsuploadImgspic=a.data.link),e()},error:function(a,e,t){console.log("error:",a,e,t),window.location.href="https://api.imgur.com/oauth2/authorize?response_type=token&client_id="+M.imgurappid}})}function C(a,e,t){$.ajax({url:"https://api.imgur.com/3/image",method:"POST",headers:{Authorization:"Bearer "+M.imgurToken,Accept:"application/json"},data:{image:a,type:"base64"},success:function(a){(M.wrp.hasClass("about")||M.wrp.hasClass("learn")||M.wrp.hasClass("link")||M.wrp.hasClass("index"))&&(M.uploadImgTrue=a.data.link),M.wrp.hasClass("news")&&(M.newspiccheck+=1,0==t?M.uploadImgbpic=a.data.link:M.uploadImgspic=a.data.link),e()},error:function(a,e,t){console.log("error:",a,e,t),window.location.href="https://api.imgur.com/oauth2/authorize?response_type=token&client_id="+M.imgurappid}})}function T(a,e){$.ajax({url:"https://api.mlab.com/api/1/databases/rhinomotor2017/collections/"+a+'?s={"_id":-1}&apiKey='+M.mlabApikey,type:"GET",contentType:"application/json",success:function(a){M.newPaperdata=a,e(a)},error:function(a,e,t){console.log("error:",a,e,t)}})}function P(a,e){$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/"+a+M.nowpage+'?s={"_id":-1}&apiKey='+M.mlabApikey,type:"GET",contentType:"application/json",success:function(t){M.learndata.push(t),M.learndata[M.learndata.length-1].collectname=a,e()},error:function(a,e,t){console.log("error:",a,e,t)}})}function q(a){return 0==a?a="日":1==a?a="一":2==a?a="二":3==a?a="三":4==a?a="四":5==a?a="五":6==a&&(a="六"),a}function A(a){window.location.href=a.attr("data-page")+"#access_token="+window.location.href.split("#access_token=")[1]}function D(){$.cookie("useraccount",""),$.cookie("userpassword",""),window.location.href="index.html"}function K(){var a=!1;return $.cookie("useraccount")&&$.cookie("userpassword")&&(a=!0),a}function O(){M.posttitleval="",M.nowtime="",M.postdesval="",M.uploadImg="",M.uploadImgTrue="",$(".new .posttitle").val(""),$(".new .postdes").val(""),$(".new .addImg").removeClass("on").find("img").attr("src","")}function U(a){a?$(".loading").fadeIn():($(".loading").hasClass("on")||$(".loading").addClass("on"),$(".loading").fadeOut())}var M={};M.wrp=$(".wrapper"),M.mlabApikey="n6FXodWWCdM14KrePZHrRPPovbzboRn6",M.imgurappid="4dd8fdf80527e2a",M.creatUsererrortxt="請填寫完整資料",M.motifyerrortxt="上一筆資料還在修改中，請先完成上一筆修改再繼續。";var S={wrp:$(".wrapper")};try{M.nowpage=getUrlVars().page.replace("#access_token","")}catch(E){M.nowpage=1}M.wrp.hasClass("cars")?T("carsPage",u):M.wrp.hasClass("news")?T("news_page",c):M.wrp.hasClass("contact")?(M.contactload=0,M.learndata=[],P("contactus",r),P("emailbox",r)):M.wrp.hasClass("index")?(M.indexload=0,M.learndata=[],P("index_banner",s),P("index_photo",s),P("index_video",s),$(".wrapper .menu").mCustomScrollbar({scrollInertia:300,scrollEasing:"linear"})):U(!1),$("#indeximgInput").change(function(){w(this,$(this),0)}),$("#indeximgInput2").change(function(){w(this,$(this),1)}),$(".maingobtn").click(function(){e($(this).parent().attr("nam"))}),$(".gogamebtn").click(function(){p()}),$(".menua").click(function(){A($(this))}),$("#imgInput").change(function(){v(this,$(this))}),$("#newsimgInput").change(function(){b(this,$(this),0)}),$("#newsimgInput2").change(function(){b(this,$(this),1)}),$(".logoutbtn").click(function(){D()}),$(".new .gobtn").click(function(){y()}),$(window).load(function(){if(K())try{M.imgurToken=window.location.href.split("#")[1].split("&")[0].replace("access_token=",""),$(".userMenu .icon").html($.cookie("useraccount").substring(0,1)),$(".userMenu .name").html($.cookie("username"))}catch(a){window.location.href="https://api.imgur.com/oauth2/authorize?response_type=token&client_id="+M.imgurappid}else window.location.href="index.html"+window.location.hash})});